{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport '../styles.css';\nimport Router from 'next/router';\nimport { useEffect, useState } from 'react';\nimport { ThemeProvider } from '@material-ui/core/styles';\nimport CssBaseline from '@material-ui/core/CssBaseline';\nimport Typography from '@material-ui/core/Typography';\nimport { makeStyles } from '@material-ui/core/styles';\nimport CircularProgress from '@material-ui/core/CircularProgress';\nimport { catalogsApi } from '../core/api';\nimport SessionService from '../services/SessionService';\nimport Login from '../modules/Login/MainLogin';\nimport BaseTheme from '../sharedComponents/BaseTheme';\nimport { SessionInfoContext } from '../core/LoginContext';\nimport LoginService from '../services/LoginService';\nimport { SnackbarProvider } from 'notistack';\nimport Layout from '../sharedComponents/Layout';\n\nfunction removeInjectedServerCss() {\n  // Remove the server-side injected CSS.\n  var jssStyles = document.querySelector('#jss-server-side');\n\n  if (jssStyles && jssStyles.parentElement) {\n    jssStyles.parentElement.removeChild(jssStyles);\n  }\n}\n\nfunction tryLogin() {\n  return _tryLogin.apply(this, arguments);\n}\n\nfunction _tryLogin() {\n  _tryLogin = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n    var ssoSessionInfo, userInfo;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.prev = 0;\n            _context.next = 3;\n            return LoginService.ssoLogin();\n\n          case 3:\n            ssoSessionInfo = _context.sent;\n\n            if (ssoSessionInfo) {\n              _context.next = 6;\n              break;\n            }\n\n            return _context.abrupt(\"return\", null);\n\n          case 6:\n            userInfo = LoginService.login(ssoSessionInfo.user.username, '', true);\n            _context.next = 9;\n            return catalogsApi.fetchAll();\n\n          case 9:\n            return _context.abrupt(\"return\", userInfo);\n\n          case 12:\n            _context.prev = 12;\n            _context.t0 = _context[\"catch\"](0);\n            console.log('Login Error', _context.t0);\n            return _context.abrupt(\"return\", null);\n\n          case 16:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee, null, [[0, 12]]);\n  }));\n  return _tryLogin.apply(this, arguments);\n}\n\nvar useStyles = makeStyles({\n  loadingMessage: {\n    display: 'flex',\n    justifyContent: 'center',\n    height: '100vh',\n    alignItems: 'center'\n  },\n  loadingIcon: {\n    marginRight: '1rem'\n  }\n});\n\nfunction App(_ref) {\n  var Component = _ref.Component,\n      pageProps = _ref.pageProps;\n  var classes = useStyles();\n\n  var _useState = useState(null),\n      modulePermissionsMap = _useState[0],\n      setModulePermissionsMap = _useState[1];\n\n  var _useState2 = useState(null),\n      sessionInfo = _useState2[0],\n      setSessionInfo = _useState2[1];\n\n  var _useState3 = useState(true),\n      loadingApp = _useState3[0],\n      setLoadingApp = _useState3[1];\n\n  useEffect(function () {\n    removeInjectedServerCss();\n    tryLogin().then(function (ssoSessionInfo) {\n      if (!ssoSessionInfo) {\n        setLoadingApp(false);\n        return handleLogout(false);\n      }\n\n      SessionService.create(ssoSessionInfo);\n      setLoadingApp(false);\n      handleSuccessfulLogin(false);\n    });\n  }, []);\n\n  function handleSuccessfulLogin() {\n    var redirect = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;\n\n    var _SessionService$get = SessionService.get(),\n        sessionInfo = _SessionService$get.sessionInfo,\n        permissionsMap = _SessionService$get.permissionsMap;\n\n    setSessionInfo(sessionInfo);\n    setModulePermissionsMap(permissionsMap);\n\n    if (redirect) {\n      Router.push('/');\n    }\n  }\n\n  function handleLogout() {\n    var redirect = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;\n    SessionService[\"delete\"]();\n    setSessionInfo(null); // Clear cookies\n\n    document.cookie = 'accessData=;expires=Thu, 01 Jan 1970 00:00:00 GMT';\n\n    if (redirect) {\n      Router.push('/');\n    }\n  }\n\n  var component = __jsx(Typography, {\n    className: classes.loadingMessage,\n    variant: \"subtitle1\"\n  }, __jsx(CircularProgress, {\n    className: classes.loadingIcon\n  }), \"Cargando, por favor espere...\");\n\n  if (!loadingApp) {\n    component = sessionInfo ? __jsx(Layout, null, __jsx(Component, pageProps)) : __jsx(Login, {\n      onLogin: handleSuccessfulLogin\n    });\n  }\n\n  return __jsx(React.Fragment, null, __jsx(CssBaseline, null), __jsx(ThemeProvider, {\n    theme: BaseTheme\n  }, __jsx(SnackbarProvider, {\n    maxSnack: 3\n  }, __jsx(SessionInfoContext.Provider, {\n    value: {\n      sessionInfo: sessionInfo,\n      onLogout: handleLogout,\n      modulePermissionsMap: modulePermissionsMap\n    }\n  }, component))));\n}\n\nexport default App;","map":null,"metadata":{},"sourceType":"module"}
{"ast":null,"code":"import Bien from '../../../../models/Bien';\nimport { bienesApi, detalleBienesApi } from '../services';\nimport { fideicomisosApi } from '../../../../core/api/fideicomisos';\nimport { OperacionesCatalogo } from '../../../../constants';\n\nasync function fetchFullModel(selectedBienesRow) {\n  if (!selectedBienesRow) {\n    return null;\n  }\n\n  let bien = new Bien(selectedBienesRow.idFideicomiso, selectedBienesRow.idSubcuenta, selectedBienesRow.idTipoBien);\n  return await bienesApi.findByPK(bien);\n}\n\nfunction selectBienesRow(selectedRow) {\n  return async dispatch => {\n    const detalleBienesSearchResults = await detalleBienesApi.find(selectedRow);\n    dispatch({\n      type: 'SELECT_BIENES_RESULT_ROW',\n      selectedRow: selectedRow,\n      detalleBienesSearchResults: detalleBienesSearchResults\n    });\n  };\n}\n\nfunction fetchAndDisplayModel(mode) {\n  return async (dispatch, getState) => {\n    const state = getState();\n    const loadedModel = await fetchFullModel(state.bienes.selectedRow);\n\n    if (loadedModel !== null) {\n      dispatch({\n        type: 'SET_BIEN_MODEL',\n        model: loadedModel\n      });\n    }\n\n    dispatch({\n      type: 'OPEN_BIENES_MODAL',\n      mode: mode\n    });\n  };\n}\n\nfunction newSearchBienes(parameters) {\n  return async dispatch => {\n    dispatch({\n      type: 'SET_BIENES_SEARCH_PARAMETERS',\n      searchParameters: parameters\n    });\n    await searchBienes(dispatch, parameters);\n  };\n}\n\nasync function searchBienes(dispatch, parameters) {\n  const bienes = await bienesApi.find(parameters);\n  dispatch({\n    type: 'SET_BIENES_SEARCH_RESULTS',\n    results: bienes\n  });\n}\n\nasync function repeatCurrentSearch(dispatch, getState) {\n  const state = getState();\n  return await searchBienes(dispatch, state.bienes.searchParameters);\n}\n\nfunction saveModel(model) {\n  return async (dispatch, getState) => {\n    const state = getState();\n    dispatch({\n      type: 'SAVE_BIEN_MODEL'\n    });\n\n    try {\n      if (state.bienes.modalMode === OperacionesCatalogo.Alta) {\n        const numFideicomiso = model.idFideicomiso || -1;\n        const fideicomisoExists = await fideicomisosApi.exists(numFideicomiso);\n\n        if (!fideicomisoExists) {\n          dispatch({\n            type: 'SET_MODEL_SAVE_ERROR',\n            error: `El fideicomiso ${numFideicomiso} no existe`\n          });\n          return;\n        }\n\n        await bienesApi.create(model);\n      } else {\n        await bienesApi.update(model);\n      }\n\n      dispatch({\n        type: 'SET_MODEL_SAVE_SUCCESS'\n      });\n      repeatCurrentSearch(dispatch, getState);\n    } catch (err) {\n      dispatch({\n        type: 'SET_MODEL_SAVE_ERROR',\n        error: err.message\n      });\n    }\n  };\n}\n\nfunction deleteSelectedModel() {\n  return async (dispatch, getState) => {\n    const state = getState();\n\n    if (!state.bienes.selectedRow) {\n      return;\n    }\n\n    const model = bienesApi.getModelFromResultRow(state.bienes.selectedRow);\n    await bienesApi.destroy(model);\n    await repeatCurrentSearch(dispatch, getState);\n  };\n}\n\nexport default {\n  selectBienesRow,\n  fetchAndDisplayModel,\n  newSearchBienes,\n  saveModel,\n  deleteSelectedModel\n};","map":null,"metadata":{},"sourceType":"module"}
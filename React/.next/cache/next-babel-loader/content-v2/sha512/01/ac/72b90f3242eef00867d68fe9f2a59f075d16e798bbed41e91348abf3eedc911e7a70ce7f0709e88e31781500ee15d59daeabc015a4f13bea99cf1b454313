{"ast":null,"code":"import Movimientos from '../../../../models/Movimientos';\nimport { polizaApi } from '../services';\nimport { OperacionesCatalogo } from '../../../../constants';\n\nasync function fetchFullModel(selectedPolizaRow) {\n  if (!selectedPolizaRow) {\n    return null;\n  }\n\n  let poliza = new Movimientos(null, null, null, null, null, null, null, null);\n  return await polizaApi.findByPK(poliza);\n}\n\nfunction selectPolizaRow(selectedRow) {\n  return async dispatch => {\n    dispatch({\n      type: 'SELECT_POLIZA_RESULT_ROW',\n      selectedRow: selectedRow\n    });\n  };\n}\n\nfunction fetchAndDisplayModel(mode) {\n  return async (dispatch, getState) => {\n    const state = getState();\n    const loadedModel = await fetchFullModel(state.Movimientos.selectedRow);\n\n    if (loadedModel !== null) {\n      dispatch({\n        type: 'SET_POLIZA_MODEL',\n        model: loadedModel\n      });\n    }\n\n    dispatch({\n      type: 'OPEN_POLIZA_MODAL',\n      mode: mode\n    });\n  };\n}\n\nfunction newSearchPoliza(parameters) {\n  return async dispatch => {\n    dispatch({\n      type: 'SET_POLIZA_SEARCH_PARAMETERS',\n      searchParameters: parameters\n    });\n    await searchPoliza(dispatch, parameters);\n  };\n}\n\nasync function searchPoliza(dispatch, parameters) {\n  const Poliza = await polizaApi.find(parameters);\n  dispatch({\n    type: 'SET_POLIZA_SEARCH_RESULTS',\n    results: Poliza\n  });\n}\n\nasync function repeatCurrentSearch(dispatch, getState) {\n  const state = getState();\n  return await searchPoliza(dispatch, state.Movimientos.searchParameters);\n}\n\nfunction saveModel(model) {\n  return async (dispatch, getState) => {\n    const state = getState();\n    dispatch({\n      type: 'SAVE_POLIZA_MODEL'\n    });\n\n    try {\n      if (state.Movimientos.modalMode === OperacionesCatalogo.Alta) {\n        await polizaApi.create(model);\n      } else {\n        await polizaApi.update(model);\n      }\n\n      dispatch({\n        type: 'SET_MODEL_SAVE_SUCCESS'\n      });\n      repeatCurrentSearch(dispatch, getState);\n    } catch (err) {\n      dispatch({\n        type: 'SET_MODEL_SAVE_ERROR',\n        error: err.message\n      });\n    }\n  };\n}\n\nfunction deleteSelectedModel() {\n  return async (dispatch, getState) => {\n    const state = getState();\n\n    if (!state.Movimientos.selectedRow) {\n      return;\n    }\n\n    const model = polizaApi.getModelFromResultRow(state.Movimientos.selectedRow);\n    await polizaApi.destroy(model);\n    await repeatCurrentSearch(dispatch, getState);\n  };\n}\n\nexport default {\n  selectPolizaRow,\n  fetchAndDisplayModel,\n  newSearchPoliza,\n  saveModel,\n  deleteSelectedModel\n};","map":null,"metadata":{},"sourceType":"module"}
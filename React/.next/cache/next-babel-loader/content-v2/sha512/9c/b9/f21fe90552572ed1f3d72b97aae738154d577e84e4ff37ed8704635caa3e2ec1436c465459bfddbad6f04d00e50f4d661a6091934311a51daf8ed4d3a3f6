{"ast":null,"code":"function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { OperacionesCatalogo } from '../../constants';\nexport default class CrudActions {\n  constructor(api) {\n    _defineProperty(this, \"api\", void 0);\n\n    this.api = api;\n  }\n\n  search(parameters) {\n    return async (dispatch) => {\n      dispatch({\n        type: 'SET_SEARCH_PARAMETERS',\n        searchParameters: parameters\n      });\n      await this.searchAndSetResults(dispatch, parameters);\n    };\n  }\n\n  async searchAndSetResults(dispatch, parameters) {\n    const results = await this.api.find(parameters);\n    dispatch({\n      type: 'SET_SEARCH_RESULTS',\n      results: results\n    });\n  }\n\n  selectRow(selectedRow) {\n    return dispatch => {\n      dispatch({\n        type: 'SET_ROWS_SELECTION',\n        selectedRow: selectedRow\n      });\n    };\n  }\n\n  async repeatCurrentSearch(dispatch, getState) {\n    const state = getState();\n    return await this.searchAndSetResults(dispatch, state.searchParameters);\n  }\n\n  fetchAndDisplayModel(mode) {\n    return async (dispatch, getState) => {\n      const state = getState();\n      const loadedModel = await this.fetchFullModel(state.selectedRow);\n\n      if (loadedModel !== null) {\n        dispatch({\n          type: 'SET_MODEL',\n          model: loadedModel\n        });\n      }\n\n      dispatch({\n        type: 'OPEN_MODAL',\n        mode: mode\n      });\n    };\n  }\n\n  saveModel(model) {\n    return async (dispatch, getState) => {\n      const state = getState();\n      dispatch({\n        type: 'SAVE_MODEL'\n      });\n\n      try {\n        if (state.modalMode === OperacionesCatalogo.Alta) {\n          const modelAlreadyExists = await this.api.exists(model);\n\n          if (modelAlreadyExists) {\n            throw new Error('El modelo ya existe');\n          }\n\n          await this.api.create(model);\n        } else {\n          await this.api.update(model);\n        }\n\n        dispatch({\n          type: 'SET_MODEL_SAVE_SUCCESS'\n        });\n        this.repeatCurrentSearch(dispatch, getState);\n      } catch (err) {\n        dispatch({\n          type: 'SET_MODEL_SAVE_ERROR',\n          error: err.message\n        });\n      }\n    };\n  }\n\n  deleteSelectedModel() {\n    return async (dispatch, getState) => {\n      const state = getState();\n\n      if (!state.selectedRow) {\n        return;\n      }\n\n      const model = this.api.getModelFromResultRow(state.selectedRow);\n      await this.api.destroy(model);\n      await this.repeatCurrentSearch(dispatch, getState);\n    };\n  }\n\n}","map":null,"metadata":{},"sourceType":"module"}
{"ast":null,"code":"import SessionInfo from '../models/SessionInfo';\nimport User from '../models/User';\nimport { Api } from '../core/api';\nimport DateUtils from '../utils/DateUtils';\n\nclass LoginService extends Api {\n  constructor() {\n    super({});\n  }\n\n  async login(username, password = '', fromSso = false) {\n    if (!fromSso) {\n      if (!username.trim() || !password.trim()) {\n        throw new Error('El usuario o password es incorrecto');\n      } else {\n        const loginDataResponse = await this.post('/login.do', {\n          username,\n          password\n        });\n        const loginData = loginDataResponse.data;\n\n        if (!loginData.data.valid) {\n          //use response to validate what to do\n          throw new Error('El usuario o password es incorrecto');\n        }\n      }\n    }\n\n    const sessionData = await this.post('/session.do', {});\n    var sessionInfo = this.getData(sessionData.data);\n    return new SessionInfo(DateUtils.toDate(sessionInfo.systemDate), new User(sessionInfo.user.username, sessionInfo.user.name), sessionInfo.permissions);\n  }\n\n  async ssoLogin() {\n    try {\n      const ssoLoginResponse = await this.post('/accessData');\n      var sessionInfo = this.getData(ssoLoginResponse.data);\n      const sessionData = sessionInfo.responseObj;\n      return new SessionInfo(new Date(), new User(sessionData.userName, sessionData.nombre), sessionData.permissions || []);\n    } catch (error) {\n      return null;\n    }\n  }\n\n  getData(fwData) {\n    var CryptoJS = require(\"crypto-js\");\n\n    var rawData = CryptoJS.enc.Base64.parse(fwData);\n    var key = CryptoJS.enc.Latin1.parse(\"eDrtRV4$345C%&7#\");\n    var iv = CryptoJS.enc.Latin1.parse(\"FiduciaWebBaNR3g\");\n    var plainTextData = CryptoJS.AES.decrypt({\n      ciphertext: rawData\n    }, key, {\n      iv: iv\n    });\n    var plainText = plainTextData.toString(CryptoJS.enc.Latin1);\n    return JSON.parse(plainText);\n  }\n\n}\n\nexport default new LoginService();","map":null,"metadata":{},"sourceType":"module"}
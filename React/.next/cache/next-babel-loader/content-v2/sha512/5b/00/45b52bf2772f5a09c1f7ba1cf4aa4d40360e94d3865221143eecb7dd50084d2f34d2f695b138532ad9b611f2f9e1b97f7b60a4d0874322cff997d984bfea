{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport { OperacionesCatalogo } from '../../constants';\n\nvar CrudActions = /*#__PURE__*/function () {\n  function CrudActions(api) {\n    _classCallCheck(this, CrudActions);\n\n    _defineProperty(this, \"api\", void 0);\n\n    this.api = api;\n  }\n\n  _createClass(CrudActions, [{\n    key: \"search\",\n    value: function search(parameters) {\n      var _this = this;\n\n      return /*#__PURE__*/function () {\n        var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(dispatch) {\n          return _regeneratorRuntime.wrap(function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  dispatch({\n                    type: 'SET_SEARCH_PARAMETERS',\n                    searchParameters: parameters\n                  });\n                  _context.next = 3;\n                  return _this.searchAndSetResults(dispatch, parameters);\n\n                case 3:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }, _callee);\n        }));\n\n        return function (_x) {\n          return _ref.apply(this, arguments);\n        };\n      }();\n    }\n  }, {\n    key: \"searchAndSetResults\",\n    value: function () {\n      var _searchAndSetResults = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(dispatch, parameters) {\n        var results;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.next = 2;\n                return this.api.find(parameters);\n\n              case 2:\n                results = _context2.sent;\n                dispatch({\n                  type: 'SET_SEARCH_RESULTS',\n                  results: results\n                });\n\n              case 4:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function searchAndSetResults(_x2, _x3) {\n        return _searchAndSetResults.apply(this, arguments);\n      }\n\n      return searchAndSetResults;\n    }()\n  }, {\n    key: \"selectRow\",\n    value: function selectRow(selectedRow) {\n      return function (dispatch) {\n        dispatch({\n          type: 'SET_ROWS_SELECTION',\n          selectedRow: selectedRow\n        });\n      };\n    }\n  }, {\n    key: \"repeatCurrentSearch\",\n    value: function () {\n      var _repeatCurrentSearch = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(dispatch, getState) {\n        var state;\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                state = getState();\n                _context3.next = 3;\n                return this.searchAndSetResults(dispatch, state.searchParameters);\n\n              case 3:\n                return _context3.abrupt(\"return\", _context3.sent);\n\n              case 4:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function repeatCurrentSearch(_x4, _x5) {\n        return _repeatCurrentSearch.apply(this, arguments);\n      }\n\n      return repeatCurrentSearch;\n    }()\n  }, {\n    key: \"fetchAndDisplayModel\",\n    value: function fetchAndDisplayModel(mode) {\n      var _this2 = this;\n\n      return /*#__PURE__*/function () {\n        var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(dispatch, getState) {\n          var state, loadedModel;\n          return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n            while (1) {\n              switch (_context4.prev = _context4.next) {\n                case 0:\n                  state = getState();\n                  _context4.next = 3;\n                  return _this2.fetchFullModel(state.selectedRow);\n\n                case 3:\n                  loadedModel = _context4.sent;\n\n                  if (loadedModel !== null) {\n                    dispatch({\n                      type: 'SET_MODEL',\n                      model: loadedModel\n                    });\n                  }\n\n                  dispatch({\n                    type: 'OPEN_MODAL',\n                    mode: mode\n                  });\n\n                case 6:\n                case \"end\":\n                  return _context4.stop();\n              }\n            }\n          }, _callee4);\n        }));\n\n        return function (_x6, _x7) {\n          return _ref2.apply(this, arguments);\n        };\n      }();\n    }\n  }, {\n    key: \"saveModel\",\n    value: function saveModel(model) {\n      var _this3 = this;\n\n      return /*#__PURE__*/function () {\n        var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5(dispatch, getState) {\n          var state, modelAlreadyExists;\n          return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n            while (1) {\n              switch (_context5.prev = _context5.next) {\n                case 0:\n                  state = getState();\n                  dispatch({\n                    type: 'SAVE_MODEL'\n                  });\n                  _context5.prev = 2;\n\n                  if (!(state.modalMode === OperacionesCatalogo.Alta)) {\n                    _context5.next = 13;\n                    break;\n                  }\n\n                  _context5.next = 6;\n                  return _this3.api.exists(model);\n\n                case 6:\n                  modelAlreadyExists = _context5.sent;\n\n                  if (!modelAlreadyExists) {\n                    _context5.next = 9;\n                    break;\n                  }\n\n                  throw new Error('El modelo ya existe');\n\n                case 9:\n                  _context5.next = 11;\n                  return _this3.api.create(model);\n\n                case 11:\n                  _context5.next = 15;\n                  break;\n\n                case 13:\n                  _context5.next = 15;\n                  return _this3.api.update(model);\n\n                case 15:\n                  dispatch({\n                    type: 'SET_MODEL_SAVE_SUCCESS'\n                  });\n\n                  _this3.repeatCurrentSearch(dispatch, getState);\n\n                  _context5.next = 22;\n                  break;\n\n                case 19:\n                  _context5.prev = 19;\n                  _context5.t0 = _context5[\"catch\"](2);\n                  dispatch({\n                    type: 'SET_MODEL_SAVE_ERROR',\n                    error: _context5.t0.message\n                  });\n\n                case 22:\n                case \"end\":\n                  return _context5.stop();\n              }\n            }\n          }, _callee5, null, [[2, 19]]);\n        }));\n\n        return function (_x8, _x9) {\n          return _ref3.apply(this, arguments);\n        };\n      }();\n    }\n  }, {\n    key: \"deleteSelectedModel\",\n    value: function deleteSelectedModel() {\n      var _this4 = this;\n\n      return /*#__PURE__*/function () {\n        var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee6(dispatch, getState) {\n          var state, model;\n          return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n            while (1) {\n              switch (_context6.prev = _context6.next) {\n                case 0:\n                  state = getState();\n\n                  if (state.selectedRow) {\n                    _context6.next = 3;\n                    break;\n                  }\n\n                  return _context6.abrupt(\"return\");\n\n                case 3:\n                  model = _this4.api.getModelFromResultRow(state.selectedRow);\n                  _context6.next = 6;\n                  return _this4.api.destroy(model);\n\n                case 6:\n                  _context6.next = 8;\n                  return _this4.repeatCurrentSearch(dispatch, getState);\n\n                case 8:\n                case \"end\":\n                  return _context6.stop();\n              }\n            }\n          }, _callee6);\n        }));\n\n        return function (_x10, _x11) {\n          return _ref4.apply(this, arguments);\n        };\n      }();\n    }\n  }]);\n\n  return CrudActions;\n}();\n\nexport { CrudActions as default };","map":null,"metadata":{},"sourceType":"module"}
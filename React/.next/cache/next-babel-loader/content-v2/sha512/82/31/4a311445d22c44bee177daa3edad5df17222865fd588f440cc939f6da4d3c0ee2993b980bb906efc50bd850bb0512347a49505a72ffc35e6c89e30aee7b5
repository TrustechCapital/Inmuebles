{"ast":null,"code":"function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { Api } from './base';\nimport CatalogItem from '../../models/CatalogItem';\nimport CacheService from '../../services/CacheService';\n\nclass CatalogNotFoundException extends Error {\n  constructor(catalogId) {\n    super(`La clave de catalogo ${catalogId} no existe`);\n  }\n\n}\n\nconst CATALOGS_CACHE_KEY = 'catalogoClaves';\n\nclass CatalogsApi extends Api {\n  constructor() {\n    super({});\n\n    _defineProperty(this, \"cachedClavesCatalog\", new Map());\n  }\n\n  async fetchAll() {\n    let results = CacheService.get(CATALOGS_CACHE_KEY);\n\n    if (!results) {\n      results = await this.getRef('catalogoCompletoclaves', {}, CatalogItem.fromObject);\n      CacheService.set(CATALOGS_CACHE_KEY, results);\n    }\n\n    const catalogsMap = results.reduce((prev, catalog) => {\n      if (!prev.has(catalog.catalogId)) {\n        prev.set(catalog.catalogId, [catalog]);\n      } else {\n        let currentValues = prev.get(catalog.catalogId) || [];\n        currentValues === null || currentValues === void 0 ? void 0 : currentValues.push(catalog);\n        prev.set(catalog.catalogId, currentValues);\n      }\n\n      return prev;\n    }, new Map());\n    this.cachedClavesCatalog = catalogsMap;\n    return results;\n  }\n\n  getCachedCatalogs() {\n    return this.cachedClavesCatalog;\n  }\n\n  getCatalogById(id) {\n    if (!this.cachedClavesCatalog.has(id)) {\n      throw new CatalogNotFoundException(id);\n    }\n\n    return this.cachedClavesCatalog.get(id) || [];\n  }\n\n  getChildCatalog(parentCatalogId, parentValue) {\n    if (parentCatalogId === null) {\n      return [];\n    }\n\n    if (!this.cachedClavesCatalog.has(parentCatalogId)) {\n      throw new CatalogNotFoundException(parentCatalogId);\n    }\n\n    const parentCatalogItems = this.cachedClavesCatalog.get(parentCatalogId) || [];\n    const parentItemSelected = parentCatalogItems.find(catalogItem => {\n      return catalogItem.value === parentValue;\n    });\n    if (!parentItemSelected || !parentItemSelected.childCatalogId) return [];\n\n    try {\n      const childCatalogId = parseInt(parentItemSelected.childCatalogId, 0);\n      return this.getCatalogById(childCatalogId);\n    } catch (error) {\n      return [];\n    }\n  }\n\n}\n\nexport const catalogsApi = new CatalogsApi();","map":null,"metadata":{},"sourceType":"module"}
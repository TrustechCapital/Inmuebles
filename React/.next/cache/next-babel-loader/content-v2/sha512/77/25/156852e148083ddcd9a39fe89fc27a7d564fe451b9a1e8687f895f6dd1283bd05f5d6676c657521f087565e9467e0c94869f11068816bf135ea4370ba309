{"ast":null,"code":"import Individualizacion from '../../../../models/Individualizacion';\nimport { reportesApi } from '../services';\nimport { OperacionesCatalogo } from '../../../../constants';\n\nasync function fetchFullModel(selectedReportesRow) {\n  if (!selectedReportesRow) {\n    return null;\n  }\n\n  let reporte = new Individualizacion(selectedReportesRow.idFideicomiso, null, null, null, null);\n  return await reportesApi.findByPK(reporte);\n}\n\nfunction selectReportesRow(selectedRow) {\n  return async dispatch => {\n    dispatch({\n      type: 'SELECT_REPORTES_RESULT_ROW',\n      selectedRow: selectedRow\n    });\n  };\n}\n\nfunction fetchAndDisplayModel(mode) {\n  return async (dispatch, getState) => {\n    const state = getState();\n    const loadedModel = await fetchFullModel(state.Individualizacion.selectedRow);\n\n    if (loadedModel !== null) {\n      dispatch({\n        type: 'SET_REPORTES_MODEL',\n        model: loadedModel\n      });\n    }\n\n    dispatch({\n      type: 'OPEN_REPORTES_MODAL',\n      mode: mode\n    });\n  };\n}\n\nfunction newSearchReportes(parameters) {\n  return async dispatch => {\n    dispatch({\n      type: 'SET_REPORTES_SEARCH_PARAMETERS',\n      searchParameters: parameters\n    });\n    await searchReportes(dispatch, parameters);\n  };\n}\n\nasync function searchReportes(dispatch, parameters) {\n  const Reportes = await reportesApi.find(parameters);\n  dispatch({\n    type: 'SET_REPORTES_SEARCH_RESULTS',\n    results: Reportes\n  });\n}\n\nfunction exportPDF(parameters) {\n  return async dispatch => {\n    reportesApi.downloadReport(parameters);\n  };\n}\n\nasync function repeatCurrentSearch(dispatch, getState) {\n  const state = getState();\n  return await searchReportes(dispatch, state.Individualizacion.searchParameters);\n}\n\nfunction saveModel(model) {\n  return async (dispatch, getState) => {\n    const state = getState();\n    dispatch({\n      type: 'SAVE_REPORTES_MODEL'\n    });\n\n    try {\n      if (state.Individualizacion.modalMode === OperacionesCatalogo.Alta) {\n        await reportesApi.create(model);\n      } else {\n        await reportesApi.update(model);\n      }\n\n      dispatch({\n        type: 'SET_MODEL_SAVE_SUCCESS'\n      });\n      repeatCurrentSearch(dispatch, getState);\n    } catch (err) {\n      dispatch({\n        type: 'SET_MODEL_SAVE_ERROR',\n        error: err.message\n      });\n    }\n  };\n}\n\nfunction deleteSelectedModel() {\n  return async (dispatch, getState) => {\n    const state = getState();\n\n    if (!state.Individualizacion.selectedRow) {\n      return;\n    }\n\n    const model = reportesApi.getModelFromResultRow(state.Individualizacion.selectedRow);\n    await reportesApi.destroy(model);\n    await repeatCurrentSearch(dispatch, getState);\n  };\n}\n\nexport default {\n  selectReportesRow,\n  fetchAndDisplayModel,\n  newSearchReportes,\n  exportPDF,\n  saveModel,\n  deleteSelectedModel\n};","map":null,"metadata":{},"sourceType":"module"}
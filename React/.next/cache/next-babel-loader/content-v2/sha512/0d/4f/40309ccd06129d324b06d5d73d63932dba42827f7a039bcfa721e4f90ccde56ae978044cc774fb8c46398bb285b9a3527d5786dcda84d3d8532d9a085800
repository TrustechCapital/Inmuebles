{"ast":null,"code":"import { detalleBienesApi } from '../services';\nimport DetalleBien from '../../../../models/DetalleBien';\nimport { OperacionesCatalogoDetalleBienes } from '../constants';\nimport { requestConfirmation } from '../../../../sharedComponents/ConfirmationModal';\n\nasync function repeatCurrentSearch(dispatch, getState) {\n  const state = getState();\n  const detalleBienesSearchResults = await detalleBienesApi.find(state.bienes.selectedRow);\n  dispatch({\n    type: 'SET_DETALLE_BIENES_SEARCH_RESULTS',\n    results: detalleBienesSearchResults\n  });\n}\n\nasync function fetchFullModel(resultRow) {\n  if (!resultRow) {\n    return null;\n  }\n\n  let detalleBien = new DetalleBien(resultRow.idFideicomiso, resultRow.idSubcuenta, resultRow.idTipoBien, resultRow.idDetalleBien, resultRow.idTipoDetalleBien);\n  return await detalleBienesApi.findByPK(detalleBien);\n}\n\nfunction newDetalleBienes() {\n  return async (dispatch, getState) => {\n    const state = getState();\n    const currentBienModel = state.bienes.currentModel;\n    const newCurrentModel = new DetalleBien(currentBienModel.idFideicomiso, currentBienModel.idSubcuenta, currentBienModel.idTipoBien, null, null);\n    dispatch({\n      type: 'OPEN_NEW_DETALLE_BIENES_MODAL',\n      mode: OperacionesCatalogoDetalleBienes.Registro,\n      newModel: newCurrentModel\n    });\n  };\n}\n\nfunction fetchAndDisplayModel(mode) {\n  return async (dispatch, getState) => {\n    const state = getState();\n    const loadedModel = await fetchFullModel(state.detalleBienes.selectedRows[0]);\n\n    if (loadedModel !== null) {\n      dispatch({\n        type: 'SET_DETALLE_BIEN_MODEL',\n        model: loadedModel\n      });\n    }\n\n    dispatch({\n      type: 'OPEN_DETALLE_BIENES_MODAL',\n      mode: mode\n    });\n  };\n}\n\nfunction saveModel(model, revaluacionDetalleBien) {\n  return async (dispatch, getState) => {\n    const state = getState();\n    const mode = state.detalleBienes.modalMode;\n    dispatch({\n      type: 'SAVE_DETALLE_BIEN_MODEL'\n    });\n\n    try {\n      if (mode === OperacionesCatalogoDetalleBienes.Registro) {\n        const newModelId = await detalleBienesApi.executeCrudOperation(model, mode);\n        model.idDetalleBien = newModelId;\n        dispatch({\n          type: 'SET_DETALLE_BIEN_MODEL',\n          model: model\n        });\n      } else {\n        await detalleBienesApi.executeCrudOperation(model, mode, revaluacionDetalleBien);\n      }\n\n      dispatch({\n        type: 'SET_DETALLE_BIEN_MODEL_SAVE_SUCCESS'\n      });\n      repeatCurrentSearch(dispatch, getState);\n    } catch (err) {\n      dispatch({\n        type: 'SET_DETALLE_BIEN_MODEL_SAVE_ERROR',\n        error: err.message\n      });\n    }\n  };\n}\n\nfunction deleteSelectedModels() {\n  return async (dispatch, getState) => {\n    const state = getState();\n    const selectedRows = state.detalleBienes.selectedRows;\n\n    if (!selectedRows.length) {\n      return;\n    }\n\n    const confirmed = await requestConfirmation({\n      title: `Esta seguro de continuar?`,\n      bodyText: `Esta a punto de eliminar eliminar ${selectedRows.length} registros. Esta operacion no se puede revertir.`\n    });\n\n    if (!confirmed) {\n      return;\n    }\n\n    const models = selectedRows.map(selectedRow => {\n      return new DetalleBien(selectedRow.idFideicomiso, selectedRow.idSubcuenta, selectedRow.idTipoBien, selectedRow.idDetalleBien, selectedRow.idTipoDetalleBien);\n    });\n    await detalleBienesApi.executeMultipleDeleteOperation(models);\n    await repeatCurrentSearch(dispatch, getState);\n  };\n}\n\nexport default {\n  newDetalleBienes,\n  fetchAndDisplayModel,\n  saveModel,\n  deleteSelectedModels\n};","map":null,"metadata":{},"sourceType":"module"}